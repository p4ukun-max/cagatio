<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>El Caga Ti√≥</title>

<style>
/* ===== FONDO NAVIDE√ëO ===== */
body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: Arial, sans-serif;
  color: white;
  background:
    radial-gradient(circle at top, #ff4d4d, #8b0000),
    linear-gradient(180deg, rgba(255,255,255,0.15), transparent);
}

/* Nieve */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background-image: radial-gradient(white 2px, transparent 2px);
  background-size: 60px 60px;
  opacity: 0.18;
  animation: snow 25s linear infinite;
  pointer-events: none;
}

@keyframes snow {
  from { background-position: 0 0; }
  to { background-position: 0 1200px; }
}

/* ===== CONTENEDOR ===== */
.game-container {
  width: 100%;
  max-width: 360px;
  padding: 16px;
  text-align: center;
  background: rgba(0,0,0,0.25);
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
}

h1 {
  margin: 10px 0;
}

/* ===== TIO ===== */
#tio {
  width: 160px;
  margin: 10px auto;
  display: block;
}

/* ===== CAJAS ===== */
/* ===== CAJAS: 4 EN L√çNEA (M√ìVIL) ===== */
#boxes {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 SIEMPRE en l√≠nea */
  gap: 8px;
  margin: 16px auto;
  max-width: 300px; /* controla que no se rompa */
}

.box {
  width: 100%;
  aspect-ratio: 1; /* cuadradas */
  background: #8b4513;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.6s ease;
  will-change: transform;
}

.box img {
  width: 40px; /* peque√±as pero visibles */
  transition: opacity 0.3s ease;
}

.box.hide-content img {
  opacity: 0;
}


/* ===== BOT√ìN ===== */
button {
  padding: 14px 22px;
  font-size: 16px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  background: linear-gradient(#ffd700, #ffb700);
  color: #7a0000;
  font-weight: bold;
  box-shadow: 0 6px 0 #cc9000;
}

button:active {
  transform: translateY(4px);
  box-shadow: 0 2px 0 #cc9000;
}

/* ===== MENSAJE ===== */
#message {
  margin-top: 10px;
  font-size: 18px;
  min-height: 24px;
}
</style>
</head>

<body>

<div class="game-container">

  <h1>El Caga Ti√≥</h1>

  <img id="tio" src="sprite_0.png">

  <div id="boxes"></div>

  <button id="hitBtn">Pegar al Ti√≥</button>

  <p id="message"></p>

</div>

<audio id="hitSound" src="hit.wav"></audio>

<script>
const boxesContainer = document.getElementById("boxes");
const hitBtn = document.getElementById("hitBtn");
const tio = document.getElementById("tio");
const message = document.getElementById("message");
const hitSound = document.getElementById("hitSound");

const gifts = {
  juguete: ["juguete1","juguete2","juguete3","juguete4","juguete5"],
  ropa: ["ropa1","ropa2","ropa3","ropa4","ropa5"],
  dulce: ["dulce1","dulce2","dulce3","dulce4","dulce5"],
  libro: ["libro1","libro2","libro3","libro4","libro5"],
  otro: ["otro1","otro2","otro3","otro4","otro5"]
};

const tioSprites = [
  "sprite_0.png",
  "sprite_1.png",
  "sprite_2.png",
  "sprite_3.png",
  "sprite_4.png",
  "sprite_5.png"
];

let boxes = [];
let canChoose = false;
let correctTheme = "";
let isAnimatingTio = false;

/* ===== CREAR 5 CAJAS ===== */
function createBoxes() {
  boxesContainer.innerHTML = "";
  boxes = [];

  const themes = Object.keys(gifts)
    .sort(() => Math.random() - 0.5)
    .slice(0, 4);

  themes.forEach(theme => {
    const imgName = gifts[theme][Math.floor(Math.random() * 5)];
    const box = document.createElement("div");
    box.className = "box";
    box.dataset.item = theme;

    const img = document.createElement("img");
    img.src = `${imgName}.png`;

    box.appendChild(img);
    boxesContainer.appendChild(box);
    boxes.push(box);

    box.addEventListener("click", () => {
      if (!canChoose) return;

      box.classList.remove("hide-content");

      message.textContent =
        box.dataset.item === correctTheme
          ? "¬°Regalo correcto!"
          : "¬°Carb√≥n!";

      canChoose = false;
    });
  });
}

/* ===== ANIMACI√ìN SPRITES TIO ===== */
  // ===== PRECARGA DE SPRITES =====
const preloadedSprites = [];
tioSprites.forEach(src => {
  const img = new Image();
  img.src = src;
  preloadedSprites.push(img);
});
function animateTio() {
  if (isAnimatingTio) return;
  isAnimatingTio = true;

  let frame = 0;
  const totalFrames = tioSprites.length;

  const interval = setInterval(() => {
    tio.src = tioSprites[frame];
    frame++;

    if (frame >= totalFrames) {
      clearInterval(interval);
      tio.src = tioSprites[5];
      isAnimatingTio = false;
    }
  }, 65);
}


/* ===== MEZCLAR CAJAS ===== */
function shuffleBoxes() {
  canChoose = false;
  message.textContent = "";

  // 1Ô∏è‚É£ Guardar posiciones iniciales
  const firstRects = boxes.map(box => box.getBoundingClientRect());

  // 2Ô∏è‚É£ Reordenar el array (nuevo orden real)
  boxes.sort(() => Math.random() - 0.5);

  // 3Ô∏è‚É£ Aplicar el nuevo orden en el DOM
  boxes.forEach(box => boxesContainer.appendChild(box));

  // 4Ô∏è‚É£ Guardar posiciones finales
  const lastRects = boxes.map(box => box.getBoundingClientRect());

  // 5Ô∏è‚É£ Invertir (levantar + desplazar)
  boxes.forEach((box, i) => {
    const dx = firstRects[i].left - lastRects[i].left;
    const dy = firstRects[i].top - lastRects[i].top;

    box.style.transform = `
      translate(${dx}px, ${dy - 40}px) 
      scale(1.1)
    `;
  });

  // 6Ô∏è‚É£ Forzar reflow
  boxesContainer.offsetHeight;

  // 7Ô∏è‚É£ Animar al sitio final
  boxes.forEach(box => {
    box.style.transform = "translate(0, 0) scale(1)";
  });

  // 8Ô∏è‚É£ Habilitar selecci√≥n al final
  setTimeout(() => {
    canChoose = true;
  }, 650);
}

/* ===== BOT√ìN ===== */
hitBtn.addEventListener("click", () => {
  if (isAnimatingTio) return;
  correctTheme = Object.keys(gifts)[Math.floor(Math.random() * 5)];

  hitSound.currentTime = 0;
  hitSound.play();

  animateTio(); // üî• AHORA S√ç FUNCIONA

  boxes.forEach(b => b.classList.add("hide-content"));
  setTimeout(shuffleBoxes, 300);
});
/* ===== INICIO ===== */
createBoxes();
</script>

</body>
</html>
